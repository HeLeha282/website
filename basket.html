<!DOCTYPE html>
<html lang="ru">

<head>
   <meta charset="UTF-8" />
   <meta name="viewport" content="width=device-width, initial-scale=1.0" />
   <title>Корзина — PC Components</title>
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
   <link rel="stylesheet" href="style_main.css" />
   <script src="main_script.js" defer></script>
   <style>
      /* Стили корзины в вашей палитре и glass-стиле */
      .basket-container {
         max-width: 900px;
         margin: 0 auto;
         padding: 20px 0 60px;
      }

      .basket-header {
         text-align: center;
         margin-bottom: 40px;
      }

      .basket-header h1 {
         font-size: 2.8rem;
         background: linear-gradient(90deg, var(--accent), var(--primary));
         -webkit-background-clip: text;
         background-clip: text;
         color: transparent;
      }

      .empty-cart {
         text-align: center;
         padding: 60px 20px;
         background: rgba(255, 255, 255, 0.06);
         border-radius: 18px;
         backdrop-filter: blur(10px);
         border: 1px solid rgba(255, 255, 255, 0.1);
         color: rgba(255, 255, 255, 0.8);
         font-size: 1.2rem;
      }

      .cart-item {
         background: rgba(255, 255, 255, 0.06);
         border: 1px solid rgba(255, 255, 255, 0.12);
         border-radius: 16px;
         padding: 16px;
         display: flex;
         gap: 16px;
         backdrop-filter: blur(10px);
         align-items: flex-start;
         /* выравнивание по верху */
         position: relative;
         animation: fadeIn 0.4s ease;
      }

      .cart-item img {
         width: 100px;
         height: 100px;
         object-fit: cover;
         border-radius: 10px;
         border: 1px solid rgba(255, 255, 255, 0.15);
         flex-shrink: 0;
         /* не сжимается */
      }

      .item-info {
         flex: 1;
         min-width: 0;
         /* позволяет тексту переноситься */
      }

      .item-info h3 {
         font-size: 1.1rem;
         margin-bottom: 6px;
         color: white;
         line-height: 1.3;
      }

      .item-price {
         color: var(--accent);
         font-weight: bold;
         font-size: 1rem;
         margin: 4px 0;
      }

      .item-total {
         font-size: 0.95rem;
         margin-top: 4px;
         color: rgba(255, 255, 255, 0.9);
      }

      /* Управление количеством */
      .quantity-control {
         display: flex;
         align-items: center;
         gap: 8px;
         margin: 8px 0;
      }

      .quantity-btn {
         width: 30px;
         height: 30px;
         border-radius: 50%;
         background: var(--primary);
         color: white;
         border: none;
         font-weight: bold;
         cursor: pointer;
         display: flex;
         align-items: center;
         justify-content: center;
         transition: var(--transition);
         font-size: 0.9rem;
      }

      .quantity-btn:hover:not(:disabled) {
         background: var(--secondary);
         transform: scale(1.1);
      }

      /* Стиль для отключённой кнопки */
      .quantity-btn:disabled {
         background: rgba(255, 255, 255, 0.15) !important;
         color: rgba(255, 255, 255, 0.5) !important;
         cursor: not-allowed !important;
         opacity: 0.7 !important;
         transform: none !important;
      }

      .quantity-value {
         min-width: 24px;
         text-align: center;
         font-size: 1rem;
         font-weight: 600;
         color: white;
      }

      /* Кнопка удаления */
      .remove-btn {
         position: absolute;
         top: 10px;
         right: 10px;
         background: none;
         border: none;
         color: var(--danger);
         font-size: 1.1rem;
         cursor: pointer;
         width: 28px;
         height: 28px;
         display: flex;
         align-items: center;
         justify-content: center;
         border-radius: 50%;
      }

      .remove-btn:hover {
         background: rgba(248, 113, 113, 0.15);
         transform: rotate(90deg);
      }

      /* Итоговая сумма и действия */
      .cart-summary {
         margin-top: 30px;
         padding: 25px;
         background: rgba(255, 255, 255, 0.06);
         border-radius: 18px;
         backdrop-filter: blur(10px);
         border: 1px solid rgba(255, 255, 255, 0.1);
         text-align: center;
      }

      .total {
         font-size: 1.5rem;
         margin: 15px 0;
         color: var(--accent);
         font-weight: bold;
      }

      .actions {
         display: flex;
         gap: 15px;
         justify-content: center;
         margin-top: 20px;
         flex-wrap: wrap;
      }

      .btn {
         padding: 12px 24px;
         border-radius: 12px;
         font-weight: 600;
         cursor: pointer;
         transition: var(--transition);
         border: none;
         font-size: 1rem;
      }

      .btn-checkout {
         background: var(--success);
         color: white;
      }

      .btn-checkout:hover {
         background: #38c16a;
         transform: translateY(-2px);
      }

      .btn-clear {
         background: rgba(248, 113, 113, 0.2);
         color: var(--danger);
      }

      .btn-clear:hover {
         background: rgba(248, 113, 113, 0.35);
         transform: translateY(-2px);
      }

      /* Сортировка */
      .sort-controls {
         display: flex;
         justify-content: center;
         gap: 12px;
         margin-bottom: 25px;
         flex-wrap: wrap;
      }

      .sort-btn {
         padding: 8px 16px;
         background: rgba(67, 97, 238, 0.2);
         color: var(--light);
         border: 1px solid rgba(67, 97, 238, 0.4);
         border-radius: 30px;
         cursor: pointer;
         transition: var(--transition);
         white-space: nowrap;
      }

      .sort-btn.active,
      .sort-btn:hover {
         background: var(--primary);
         border-color: var(--primary);
      }

      /* Анимации */
      @keyframes fadeIn {
         from {
            opacity: 0;
            transform: translateY(10px);
         }

         to {
            opacity: 1;
            transform: translateY(0);
         }
      }

      @keyframes fadeOut {
         to {
            opacity: 0;
            transform: translateY(-10px);
         }
      }

      .fade-out {
         animation: fadeOut 0.3s forwards;
      }

      /* Адаптив для очень узких экранов */
      @media (max-width: 480px) {
         .basket-header h1 {
            font-size: 2.2rem;
         }

         .cart-item {
            padding: 12px;
            gap: 12px;
         }

         .cart-item img {
            width: 80px;
            height: 80px;
         }

         .item-info h3 {
            font-size: 1rem;
         }

         .quantity-btn {
            width: 26px;
            height: 26px;
            font-size: 0.85rem;
         }

         .quantity-value {
            min-width: 20px;
            font-size: 0.95rem;
         }

         .item-total {
            font-size: 0.9rem;
         }

         .sort-controls {
            gap: 8px;
         }

         .sort-btn {
            padding: 6px 12px;
            font-size: 0.9rem;
         }

         .btn {
            padding: 10px 20px;
            font-size: 0.95rem;
         }
      }
   </style>
</head>

<body>
   <!-- Шапка -->
   <header class="header">
      <div class="container header-container">
         <a href="index.html" class="logo">
            <i class="fab fa-telegram"></i> PC Components
         </a>

         <!-- Иконка бургерменю -->
         <button class="header__burger-btn" id="burger">
            <span></span><span></span><span></span>
         </button>
         <nav>
            <ul id="navMenu">
               <li><a href="index.html" class="active">Главная</a></li>
               <li><a href="catalog.html">Каталог</a></li>
               <li><a href="basket.html">Корзина</a></li>
               <li><a href="reviews.html">Отзывы</a></li>
               <li><a href="login.html">Войти</a></li>
            </ul>
         </nav>

      </div>
   </header>


   <!-- Основной контент -->
   <main>
      <div class="container">
         <div class="basket-container">
            <div class="basket-header">
               <h1>Ваша корзина</h1>

               <!-- Кнопки сортировки -->
               <div class="sort-controls">
                  <button class="sort-btn active" data-sort="default">По порядку</button>
                  <button class="sort-btn" data-sort="price-asc">Цена: ↑</button>
                  <button class="sort-btn" data-sort="price-desc">Цена: ↓</button>
                  <button class="sort-btn" data-sort="name">По названию</button>
               </div>
            </div>

            <div id="cart-content">
               <!-- Сюда подгружается содержимое корзины -->
            </div>

            <div class="cart-summary">
               <div class="total">Итого: <span id="total-price">0 ₽</span></div>
               <div class="actions">
                  <button class="btn btn-checkout" id="checkout-btn">Оформить заказ</button>
                  <button class="btn btn-clear" id="clear-cart">Очистить корзину</button>
               </div>
            </div>
         </div>
      </div>
   </main>

   <!-- Подвал -->
   <footer>
      <div class="container">
         <div class="footer-content">
            <div class="footer-column">
               <h3>PC Components</h3>
               <p>Лучшие компьютерные комплектующие для ваших задач.</p>
            </div>
            <div class="footer-column">
               <h3>Каталог</h3>
               <ul>
                  <li><a href="processors.html">Процессоры</a></li>
                  <li><a href="videocards.html">Видеокарты</a></li>
               </ul>
            </div>
            <div class="footer-column">
               <h3>Аккаунт</h3>
               <ul>
                  <li><a href="basket.html">Корзина</a></li>
                  <li><a href="login.html">Войти</a></li>
               </ul>
            </div>
         </div>
         <div class="copyright">&copy; 2025 PC Components. Все права защищены.</div>
      </div>
   </footer>

   <script>
      let cart = JSON.parse(localStorage.getItem('cart')) || [];
      let currentSort = 'default';

      document.addEventListener('DOMContentLoaded', () => {
         // Убедимся, что у всех товаров есть addedAt (для правильной сортировки "по порядку")
         cart.forEach((item, i) => {
            if (item.addedAt === undefined) item.addedAt = i;
         });
         saveCart();

         renderCart();

         // === ДЕЛЕГИРОВАНИЕ СОБЫТИЙ НА ВЕСЬ КОНТЕЙНЕР КОРЗИНЫ ===
         const cartContainer = document.getElementById('cart-content');
         cartContainer.addEventListener('click', (e) => {
            // Кнопка "+"
            if (e.target.classList.contains('inc')) {
               const id = e.target.dataset.id;
               const added = e.target.dataset.added;
               changeQuantity(id, added, 1);
            }
            // Кнопка "−"
            else if (e.target.classList.contains('dec')) {
               const id = e.target.dataset.id;
               const added = e.target.dataset.added;
               changeQuantity(id, added, -1);
            }
            // Кнопка удаления (с поддержкой клика по иконке <i>)
            else if (e.target.closest('.remove-btn')) {
               const btn = e.target.closest('.remove-btn');
               const id = btn.dataset.id;
               const added = btn.dataset.added;
               removeFromCart(id, added);
            }
         });

         // === СОРТИРОВКА ===
         document.querySelectorAll('.sort-btn').forEach(btn => {
            btn.addEventListener('click', () => {
               currentSort = btn.dataset.sort;
               document.querySelectorAll('.sort-btn').forEach(b => b.classList.remove('active'));
               btn.classList.add('active');
               renderCart(); // Полная перерисовка при смене сортировки
            });
         });

         // === ОЧИСТКА КОРЗИНЫ ===
         document.getElementById('clear-cart')?.addEventListener('click', () => {
            if (confirm('Очистить корзину?')) {
               cart = [];
               saveCart();
               renderCart();
            }
         });

         // === ОФОРМЛЕНИЕ ЗАКАЗА (заглушка) ===
         document.getElementById('checkout-btn')?.addEventListener('click', () => {
            if (cart.length === 0) {
               alert('Корзина пуста!');
               return;
            }
            alert('Функция оформления заказа будет доступна в ближайшее время!\nСпасибо за интерес к PC Components!');
         });
      });

      // --- ФУНКЦИИ ---

      function renderCart() {
         const container = document.getElementById('cart-content');
         if (cart.length === 0) {
            container.innerHTML = `
        <div class="empty-cart">
          Ваша корзина пуста.<br>
          <a href="catalog.html" style="color: var(--accent); text-decoration: underline;">Перейти в каталог</a>
        </div>
      `;
            updateTotal();
            return;
         }

         // Сортируем копию корзины
         let displayCart = [...cart];
         switch (currentSort) {
            case 'price-asc':
               displayCart.sort((a, b) => a.price - b.price);
               break;
            case 'price-desc':
               displayCart.sort((a, b) => b.price - a.price);
               break;
            case 'name':
               displayCart.sort((a, b) => a.name.localeCompare(b.name, 'ru'));
               break;
            default:
               displayCart.sort((a, b) => a.addedAt - b.addedAt);
               break;
         }

         let html = '';
         displayCart.forEach(item => {
            const qty = item.quantity || 1;
            const itemTotal = item.price * qty;
            html += `
        <div class="cart-item" data-id="${item.id}" data-added="${item.addedAt}">
          <img src="${item.image || 'img/placeholder.jpg'}" alt="${item.name}">
          <div class="item-info">
            <h3>${item.name}</h3>
            <div class="item-price">${item.price.toLocaleString()} ₽</div>
            <div class="quantity-control">
              <button class="quantity-btn dec" data-id="${item.id}" data-added="${item.addedAt}" ${qty <= 1 ? 'disabled' : ''}>−</button>
              <span class="quantity-value" data-id="${item.id}" data-added="${item.addedAt}">${qty}</span>
              <button class="quantity-btn inc" data-id="${item.id}" data-added="${item.addedAt}">+</button>
            </div>
            <div class="item-total" data-id="${item.id}" data-added="${item.addedAt}">
              Итого: <strong>${itemTotal.toLocaleString()} ₽</strong>
            </div>
          </div>
          <button class="remove-btn" data-id="${item.id}" data-added="${item.addedAt}">
            <i class="fas fa-trash"></i>
          </button>
        </div>
      `;
         });

         container.innerHTML = html;
         updateTotal();
      }

      function updateCartItemUI(id, addedAt) {
         const item = cart.find(i => i.id === id && i.addedAt == addedAt);
         if (!item) return;

         const qty = item.quantity || 1;
         const itemTotal = item.price * qty;

         // Обновляем количество
         const qtyEl = document.querySelector(`.quantity-value[data-id="${id}"][data-added="${addedAt}"]`);
         if (qtyEl) qtyEl.textContent = qty;

         // Обновляем итог по товару
         const totalEl = document.querySelector(`.item-total[data-id="${id}"][data-added="${addedAt}"]`);
         if (totalEl) {
            totalEl.innerHTML = `Итого: <strong>${itemTotal.toLocaleString()} ₽</strong>`;
         }

         // Обновляем состояние кнопки "−"
         const decBtn = document.querySelector(`.quantity-btn.dec[data-id="${id}"][data-added="${addedAt}"]`);
         if (decBtn) {
            if (qty <= 1) {
               decBtn.disabled = true;
               decBtn.style.opacity = '0.5';
               decBtn.style.cursor = 'not-allowed';
            } else {
               decBtn.disabled = false;
               decBtn.style.opacity = '1';
               decBtn.style.cursor = 'pointer';
            }
         }

         updateTotal();
      }

      function updateTotal() {
         const total = cart.reduce((sum, item) => sum + (item.price * (item.quantity || 1)), 0);
         document.getElementById('total-price').textContent = total.toLocaleString() + ' ₽';
      }

      function removeFromCart(id, addedAt) {
         const index = cart.findIndex(i => i.id === id && i.addedAt == addedAt);
         if (index === -1) return;

         const itemEl = document.querySelector(`.cart-item[data-id="${id}"][data-added="${addedAt}"]`);
         if (itemEl) {
            itemEl.classList.add('fade-out');
            setTimeout(() => {
               cart.splice(index, 1);
               saveCart();
               renderCart(); // Удаление → перерисовка (нормально)
            }, 300);
         }
      }

      function changeQuantity(id, addedAt, delta) {
         const item = cart.find(i => i.id === id && i.addedAt == addedAt);
         if (!item) return;

         const newQty = (item.quantity || 1) + delta;
         if (newQty < 1) return; // Защита

         item.quantity = newQty;
         saveCart();
         updateCartItemUI(id, addedAt); // ← Только обновление UI, без перерисовки списка
      }

      function saveCart() {
         localStorage.setItem('cart', JSON.stringify(cart));
      }
   </script>
</body>

</html>