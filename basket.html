<!DOCTYPE html>
<html lang="ru">

<head>
   <meta charset="UTF-8" />
   <meta name="viewport" content="width=device-width, initial-scale=1.0" />
   <title>Корзина — PC Components</title>
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
   <link rel="stylesheet" href="css/style_main.css">
   <script src="js/main_script.js" defer></script>
   <link rel="stylesheet" href="css/style_basket.css">
</head>

<body>
   <!-- Шапка -->
   <header class="header">
      <div class="container header-container">
         <a href="index.html" class="logo">
            <i class="fas fa-microchip"></i> PC Components
         </a>

         <!-- Иконка бургерменю -->
         <button class="header__burger-btn" id="burger">
            <span></span><span></span><span></span>
         </button>
         <nav>
            <ul id="navMenu">
               <li><a href="index.html">Главная</a></li>
               <li><a href="catalog.html">Каталог</a></li>
               <li><a href="basket.html" class="active">Корзина</a></li>
               <li><a href="reviews.html">Отзывы</a></li>
               <li><a href="login.html">Войти</a></li>
            </ul>
         </nav>
      </div>
   </header>

   <!-- Основной контент -->
   <main>
      <div class="container">
         <h1>Ваша корзина</h1>
         <div class="basket-container">
            <div class="basket-header">

               <div class="sort-controls">
                  <button class="sort-btn active" data-sort="default">По порядку</button>
                  <button class="sort-btn" data-sort="price-asc">Цена: ↑</button>
                  <button class="sort-btn" data-sort="price-desc">Цена: ↓</button>
                  <button class="sort-btn" data-sort="name">По названию</button>
               </div>
            </div>

            <div id="cart-content">
               <!-- Сюда подгружается содержимое корзины -->
            </div>

            <div class="cart-summary">
               <div class="total">Итого: <span id="total-price">0 ₽</span></div>
               <div class="actions">
                  <button class="btn btn-checkout" id="checkout-btn">Оформить заказ</button>
                  <button class="btn btn-clear" id="clear-cart">Очистить корзину</button>
               </div>
            </div>
         </div>
      </div>
   </main>

   <!-- Подвал -->
   <footer>
      <div class="container">
         <div class="footer-content">
            <div class="footer-column">
               <h3>PC Components</h3>
               <p>Лучшие компьютерные комплектующие для ваших задач.</p>
               <p class="cont-inf">Телефон: <a href="tel:+74951234567">+7 (495) 123-45-67</a></p> <!-- <a> -->
               <p class="cont-inf">Email: <a href="mailto:info@example.com">info@example.com</a></p> <!-- <a> -->
            </div>
            <div class="footer-column">
               <h3>Каталог</h3>
               <ul>
                  <li><a href="pages/processors.html">Процессоры</a></li>
                  <li><a href="pages/videocards.html">Видеокарты</a></li>
                  <li><a href="pages/ram.html">ОЗУ</a></li>
                  <li><a href="pages/motherboards.html">Материнские платы</a></li>
                  <li><a href="pages/cooling_system.html">Системы охлаждения</a></li>
                  <li><a href="pages/case.html">Корпуса</a></li>
                  <li><a href="pages/power.html">Блоки питания</a></li>
                  <li><a href="pages/disks.html">Накопители</a></li>
               </ul>
            </div>
            <div class="footer-column">
               <h3>Информация</h3>
               <ul>
                  <li><a href="reviews.html">Отзывы</a></li>
               </ul>
            </div>
            <div class="footer-column">
               <h3>Аккаунт</h3>
               <ul>
                  <li><a href="basket.html">Корзина</a></li>
                  <li><a href="login.html">Войти</a></li>
               </ul>
            </div>
         </div>
         <div class="copyright">&copy; 2025 PC Components. Все права защищены.</div>
      </div>
   </footer>

   <script>
      let cart = JSON.parse(localStorage.getItem('cart')) || [];
      let currentSort = 'default';

      document.addEventListener('DOMContentLoaded', () => {
         cart.forEach((item, i) => {
            if (item.addedAt === undefined) item.addedAt = i;
         });
         saveCart();

         renderCart();

         const cartContainer = document.getElementById('cart-content');
         cartContainer.addEventListener('click', (e) => {
            if (e.target.classList.contains('inc')) {
               const id = e.target.dataset.id;
               const added = e.target.dataset.added;
               changeQuantity(id, added, 1);
            } else if (e.target.classList.contains('dec')) {
               const id = e.target.dataset.id;
               const added = e.target.dataset.added;
               changeQuantity(id, added, -1);
            } else if (e.target.closest('.remove-btn')) {
               const btn = e.target.closest('.remove-btn');
               const id = btn.dataset.id;
               const added = btn.dataset.added;
               removeFromCart(id, added);
            }
         });

         document.querySelectorAll('.sort-btn').forEach(btn => {
            btn.addEventListener('click', () => {
               currentSort = btn.dataset.sort;
               document.querySelectorAll('.sort-btn').forEach(b => b.classList.remove('active'));
               btn.classList.add('active');
               renderCart();
            });
         });

         document.getElementById('clear-cart')?.addEventListener('click', () => {
            if (confirm('Очистить корзину?')) {
               cart = [];
               saveCart();
               renderCart();
            }
         });

         document.getElementById('checkout-btn')?.addEventListener('click', () => {
            if (cart.length === 0) {
               alert('Корзина пуста!');
               return;
            }
            alert('Функция оформления заказа будет доступна в ближайшее время!\nСпасибо за интерес к PC Components!');
         });
      });

      function renderCart() {
         const container = document.getElementById('cart-content');
         if (cart.length === 0) {
            container.innerHTML = `
              <div class="empty-cart">
                Ваша корзина пуста.<br>
                <a href="catalog.html" style="color: var(--accent); text-decoration: underline;">Перейти в каталог</a>
              </div>
            `;
            updateTotal();
            return;
         }

         let displayCart = [...cart];
         switch (currentSort) {
            case 'price-asc':
               displayCart.sort((a, b) => a.price - b.price);
               break;
            case 'price-desc':
               displayCart.sort((a, b) => b.price - a.price);
               break;
            case 'name':
               displayCart.sort((a, b) => a.name.localeCompare(b.name, 'ru'));
               break;
            default:
               displayCart.sort((a, b) => a.addedAt - b.addedAt);
               break;
         }

         let html = '';
         displayCart.forEach(item => {
            const qty = item.quantity || 1;
            const itemTotal = item.price * qty;
            html += `
              <div class="cart-item" data-id="${item.id}" data-added="${item.addedAt}">
                <img src="${item.image || 'img/placeholder.jpg'}" alt="${item.name}">
                <div class="item-info">
                  <div class="item-header">
                    <h3>${item.name}</h3>
                    <button class="remove-btn" data-id="${item.id}" data-added="${item.addedAt}">
                      <i class="fas fa-trash"></i>
                    </button>
                  </div>
                  <div class="item-price">${item.price.toLocaleString()} ₽</div>
                  <div class="quantity-control">
                    <button class="quantity-btn dec" data-id="${item.id}" data-added="${item.addedAt}" ${qty <= 1 ? 'disabled' : ''}>−</button>
                    <span class="quantity-value" data-id="${item.id}" data-added="${item.addedAt}">${qty}</span>
                    <button class="quantity-btn inc" data-id="${item.id}" data-added="${item.addedAt}">+</button>
                  </div>
                  <div class="item-total" data-id="${item.id}" data-added="${item.addedAt}">
                    Итого: <strong>${itemTotal.toLocaleString()} ₽</strong>
                  </div>
                </div>
              </div>
            `;
         });

         container.innerHTML = html;
         updateTotal();
      }

      function updateCartItemUI(id, addedAt) {
         const item = cart.find(i => i.id === id && i.addedAt == addedAt);
         if (!item) return;

         const qty = item.quantity || 1;
         const itemTotal = item.price * qty;

         const qtyEl = document.querySelector(`.quantity-value[data-id="${id}"][data-added="${addedAt}"]`);
         if (qtyEl) qtyEl.textContent = qty;

         const totalEl = document.querySelector(`.item-total[data-id="${id}"][data-added="${addedAt}"]`);
         if (totalEl) {
            totalEl.innerHTML = `Итого: <strong>${itemTotal.toLocaleString()} ₽</strong>`;
         }

         const decBtn = document.querySelector(`.quantity-btn.dec[data-id="${id}"][data-added="${addedAt}"]`);
         if (decBtn) {
            if (qty <= 1) {
               decBtn.disabled = true;
               decBtn.style.opacity = '0.5';
               decBtn.style.cursor = 'not-allowed';
            } else {
               decBtn.disabled = false;
               decBtn.style.opacity = '1';
               decBtn.style.cursor = 'pointer';
            }
         }

         updateTotal();
      }

      function updateTotal() {
         const total = cart.reduce((sum, item) => sum + (item.price * (item.quantity || 1)), 0);
         document.getElementById('total-price').textContent = total.toLocaleString() + ' ₽';
      }

      function removeFromCart(id, addedAt) {
         const index = cart.findIndex(i => i.id === id && i.addedAt == addedAt);
         if (index === -1) return;

         const itemEl = document.querySelector(`.cart-item[data-id="${id}"][data-added="${addedAt}"]`);
         if (itemEl) {
            itemEl.classList.add('fade-out');
            setTimeout(() => {
               cart.splice(index, 1);
               saveCart();
               renderCart();
            }, 300);
         }
      }

      function changeQuantity(id, addedAt, delta) {
         const item = cart.find(i => i.id === id && i.addedAt == addedAt);
         if (!item) return;

         const newQty = (item.quantity || 1) + delta;
         if (newQty < 1) return;

         item.quantity = newQty;
         saveCart();
         updateCartItemUI(id, addedAt);
      }

      function saveCart() {
         localStorage.setItem('cart', JSON.stringify(cart));
      }
   </script>
</body>

</html>